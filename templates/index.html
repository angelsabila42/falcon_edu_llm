<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falcon Co-Teacher</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* Ensures the model's output (which often contains newline characters) is formatted correctly */
        #responseText {
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 sm:p-8">
    <!-- Main Application Container -->
    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 sm:p-8 transition-all duration-300 my-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-teal-700 mb-2 text-center">
            EduVison
        </h1>
        <p class="text-gray-600 mb-6 text-center">
            Powered by the Falcon-1B-Instruct model.
        </p>

        <!-- Prompt Input -->
        <label for="promptInput" class="block text-lg font-semibold text-gray-700 mb-2">
            Enter your lesson prompt:
        </label>
        <textarea
            id="promptInput"
            rows="5"
            class="w-full p-4 border-2 border-teal-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 transition duration-150 text-gray-700 placeholder-gray-400 mb-4"
            placeholder="E.g., Create a home lesson plan for a 10-year-old with autism on the topic of photosynthesis, focusing on visual aids and short, simple sentences."
        ></textarea>

        <!-- Submit Button -->
        <button
            id="generateButton"
            onclick="generateResponse()"
            class="w-full py-3 px-4 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-lg transition duration-150 ease-in-out transform hover:scale-[1.005] focus:outline-none focus:ring-4 focus:ring-teal-500 focus:ring-opacity-50"
        >
            Generate 
        </button>

        <!-- Loading & Error Messages -->
        <div id="statusMessage" class="mt-4 p-3 rounded-lg text-center font-medium hidden">
            <!-- Used for both loading and errors -->
        </div>

        <!-- Output Area -->
        <div id="outputContainer" class="mt-8 pt-6 border-t-2 border-gray-200 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Generated Lesson Plan</h2>
            <div id="responseText" class="bg-gray-50 p-6 rounded-lg shadow-inner text-gray-800 leading-relaxed border border-gray-200">
                <!-- Response content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- JavaScript for API Communication -->
    <script>
        const promptInput = document.getElementById('promptInput');
        const generateButton = document.getElementById('generateButton');
        const outputContainer = document.getElementById('outputContainer');
        const responseText = document.getElementById('responseText');
        const statusMessage = document.getElementById('statusMessage');

        function setUIState(isLoading, message = '', isError = false) {
            generateButton.disabled = isLoading;
            generateButton.textContent = isLoading ? 'Loading Model and Generating...' : 'Generate Lesson';
            generateButton.classList.toggle('opacity-60', isLoading);
            generateButton.classList.toggle('cursor-not-allowed', isLoading);
            
            statusMessage.classList.add('hidden');
            if (message) {
                statusMessage.textContent = message;
                statusMessage.classList.remove('hidden');
                
                // Set colors based on state
                statusMessage.classList.toggle('bg-red-100', isError);
                statusMessage.classList.toggle('text-red-700', isError);
                statusMessage.classList.toggle('bg-teal-100', isLoading && !isError);
                statusMessage.classList.toggle('text-teal-700', isLoading && !isError);
            }
        }

        async function generateResponse() {
            const prompt = promptInput.value.trim();

            if (!prompt) {
                setUIState(false, 'Please enter a prompt.', true);
                return;
            }

            // Initial message: Model loading can take a minute on first run
            setUIState(true, 'Model is loading and generating the response. This may take a minute on the first request.', false);
            
            outputContainer.classList.add('hidden');
            responseText.textContent = ''; 

            try {
                // Fetch call to the Flask endpoint
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) {
                    // Try to extract JSON error message from the backend
                    const errorJson = await response.json().catch(() => ({}));
                    throw new Error(errorJson.error || `HTTP Error ${response.status}: Failed to generate lesson.`);
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // Display the generated text
                responseText.textContent = data.text;
                outputContainer.classList.remove('hidden');
                setUIState(false, 'Generation complete!');

            } catch (error) {
                // Handle all network or application errors
                setUIState(false, `Generation failed: ${error.message}. If this is the first attempt, the model may still be loading on the server.`, true);
            }
        }
    </script>
</body>
</html>
